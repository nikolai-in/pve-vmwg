# Network interface configuration for VM subnet with VPN routing
# Generated by Ansible - DO NOT EDIT MANUALLY
#version:11
# shellcheck disable=SC2148

auto vmwg0
iface vmwg0
address {{ vm_gateway }}/24
post-up iptables -t nat -A POSTROUTING -s '{{ vm_subnet }}' -o wg0 -j MASQUERADE
post-down iptables -t nat -D POSTROUTING -s '{{ vm_subnet }}' -o wg0 -j MASQUERADE
post-up iptables -t raw -I PREROUTING -i fwbr+ -j CT --zone 1
post-down iptables -t raw -D PREROUTING -i fwbr+ -j CT --zone 1
# Policy-based routing for VM subnet through WireGuard
post-up ip rule add from {{ vm_subnet }} table {{ routing_table_id }} priority 100
post-down ip rule del from {{ vm_subnet }} table {{ routing_table_id }} priority 100 2>/dev/null || true
post-up ip rule add to {{ vm_subnet }} table {{ routing_table_id }} priority 101
post-down ip rule del to {{ vm_subnet }} table {{ routing_table_id }} priority 101 2>/dev/null || true
bridge_ports none
bridge_stp off
bridge_fd 0
ip-forward on
