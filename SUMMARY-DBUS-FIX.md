# –°–≤–æ–¥–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ D-Bus

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ñ–∏–∫—Å–∞ D-Bus, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ SDN —Å–µ—Ç–∏ Proxmox –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–º–µ–Ω D-Bus —Å–µ—Ä–≤–∏—Å–æ–≤.

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ D-Bus —Å–µ—Ä–≤–∏—Å–æ–≤**

- **–ù–∞—à —Å–µ—Ä–≤–∏—Å:** `uk.org.thekelleys.dnsmasq.vmwgnat`
- **Proxmox SDN:** `uk.org.thekelleys.dnsmasq.dhcpsnat` (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)

### 2. **–ò–∑–æ–ª—è—Ü–∏—è –ø–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º**

```bash
# –ù–∞—à dnsmasq —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å vmwg0
interface=vmwg0
bind-interfaces
```

### 3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞**

- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö D-Bus —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π cleanup –ø–ª–µ–π–±—É–∫

### 4. **–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**

- `templates/dnsmasq-dhcpsnat.conf.j2` ‚Üí `templates/dnsmasq-vmwgnat.conf.j2`
- `templates/dnsmasq-default.conf.j2` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–∑–æ–ª—è—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- `deploy-vmwg-subnet.yml` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞
- `cleanup-vmwg-subnet.yml` - —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**:

- **vmwgnat** (–Ω–∞—à) - –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç vmwg0, VPN –ø–æ–¥—Å–µ—Ç—å 10.10.0.0/24
- **dhcpsnat** (Proxmox) - –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ SDN —Å–µ—Ç–∏

## üìã –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

```bash
# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
ansible-playbook deploy-vmwg-subnet.yml

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞
systemctl status dnsmasq@vmwgnat
systemctl status dnsmasq@dhcpsnat
```

## üêõ –û–± –æ—à–∏–±–∫–µ -15 –≤ cleanup

–ö–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ -15 (SIGTERM) –≤ –∑–∞–¥–∞—á–µ "Kill any remaining failsafe background processes" –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω - –ø—Ä–æ—Å—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω—ã. –¢–µ–ø–µ—Ä—å —ç—Ç–∞ –∑–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
