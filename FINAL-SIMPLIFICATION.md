# üéØ –§–∏–Ω–∞–ª—å–Ω–æ–µ —É–ø—Ä–æ—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ: –£–±—Ä–∞–ª–∏ –≤—Å—é D-Bus —Å–ª–æ–∂–Ω–æ—Å—Ç—å

### ü§î **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ?**

**D-Bus –Ω—É–∂–µ–Ω –¢–û–õ–¨–ö–û –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ Proxmox SDN `dhcpsnat`**, –∞ –ù–ï –¥–ª—è –Ω–∞—à–µ–≥–æ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ `vmwgnat`!

### üìä **–î–æ vs –ü–æ—Å–ª–µ**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –î–û | –ü–û–°–õ–ï | –°—Ç–∞—Ç—É—Å |
|-----------|-------|-------|---------|
| DHCP –¥–ª—è –í–ú | ‚úÖ | ‚úÖ | –†–∞–±–æ—Ç–∞–µ—Ç |
| DNS —Ä–µ–∑–æ–ª–≤–∏–Ω–≥ | ‚úÖ | ‚úÖ | –†–∞–±–æ—Ç–∞–µ—Ç |
| VPN –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è | ‚úÖ | ‚úÖ | –†–∞–±–æ—Ç–∞–µ—Ç |
| D-Bus –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | ‚ùå –ü—Ä–æ–±–ª–µ–º—ã | ‚ùå –ù–µ –Ω—É–∂–Ω–æ | –£–ø—Ä–æ—â–µ–Ω–æ |
| XML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | ‚ùå –û—à–∏–±–∫–∏ | ‚úÖ –£–±—Ä–∞–Ω–æ | –£–ø—Ä–æ—â–µ–Ω–æ |
| –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ | ‚ùå –ë—ã–ª–∏ | ‚úÖ –ù–µ—Ç | –£–ø—Ä–æ—â–µ–Ω–æ |

### üóÇÔ∏è **–£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

#### –§–∞–π–ª—ã:
- ‚ùå `templates/dnsmasq-vmwgnat.conf.j2` (D-Bus –ø–æ–ª–∏—Ç–∏–∫–∞)
- ‚ùå `templates/enable-dnsmasq-dbus.sh.j2` (D-Bus enabler)

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- ‚ùå `enable-dbus=uk.org.thekelleys.dnsmasq.vmwgnat`
- ‚ùå D-Bus XML –ø–æ–ª–∏—Ç–∏–∫–∏
- ‚ùå D-Bus handlers –≤ Ansible

#### –ó–∞–¥–∞—á–∏ Ansible:
- ‚ùå Deploy D-Bus policy
- ‚ùå Remove old D-Bus policy  
- ‚ùå Force reload D-Bus
- ‚ùå Enable D-Bus integration
- ‚ùå Create D-Bus enabler script

### üöÄ **–†–µ–∑—É–ª—å—Ç–∞—Ç: –ü—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**

#### ‚úÖ **–ú–µ–Ω—å—à–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ = –±–æ–ª—å—à–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏:**
1. **–ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
2. **–ù–µ—Ç XML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π** - –Ω–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
3. **–ù–µ—Ç D-Bus –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** - –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. **–ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –º–µ–Ω—å—à–µ –º–µ—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—Ä–æ–±–ª–µ–º

#### ‚úÖ **–ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å (—Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ):**
- üìÅ `dnsmasq` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –ø—Ä–æ—Å—Ç—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- üîß `systemd` —Å–µ—Ä–≤–∏—Å—ã - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- üõ†Ô∏è –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã - —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- üåê –°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ

### üéØ **–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ:**

1. **–°–æ–∑–¥–∞–µ—Ç bridge vmwg0** –¥–ª—è –í–ú
2. **–†–∞–∑–¥–∞–µ—Ç DHCP** –í–ú –≤ –ø–æ–¥—Å–µ—Ç–∏ 10.10.0.0/24
3. **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –í–ú** —á–µ—Ä–µ–∑ WireGuard VPN
4. **–ù–ï –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç** —Å Proxmox SDN

### üìã **–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —É–ø—Ä–æ—â–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏:**

```bash
# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —É–ø—Ä–æ—â–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É
ansible-playbook deploy-vmwg-subnet.yml

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É
ssh root@pve-host
systemctl status dnsmasq@vmwgnat
/root/debug-dnsmasq.sh
```

---

**üí° –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: "–î–µ–ª–∞–π –æ–¥–Ω—É –≤–µ—â—å –∏ –¥–µ–ª–∞–π –µ—ë —Ö–æ—Ä–æ—à–æ"**

–ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞: **–ø—Ä–æ—Å—Ç–∞—è VPN –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –¥–ª—è –í–ú**  
Proxmox SDN: **—Å–ª–æ–∂–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç—è–º–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**

–ö–∞–∂–¥–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ—à–∞–µ—Ç —Å–≤–æ—é –∑–∞–¥–∞—á—É –±–µ–∑ –≤–∑–∞–∏–º–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤! üéâ
