# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "unknown interface vmwg0" –≤ dnsmasq

## –ü—Ä–æ–±–ª–µ–º–∞

–°–µ—Ä–≤–∏—Å `dnsmasq@vmwgnat` –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è —Å –æ—à–∏–±–∫–æ–π:
```
dnsmasq: unknown interface vmwg0
FAILED to start up
```

## –ü—Ä–∏—á–∏–Ω–∞

1. **–ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞**: dnsmasq –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `vmwg0` —Å–æ–∑–¥–∞–Ω –∏ –ø–æ–¥–Ω—è—Ç
2. **–°—Ç—Ä–æ–≥–∞—è –ø—Ä–∏–≤—è–∑–∫–∞**: `bind-interfaces` —Ç—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: systemd –Ω–µ –∑–Ω–∞–µ—Ç –æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò–∑–º–µ–Ω–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è dnsmasq
**–ë—ã–ª–æ:** `bind-interfaces` (—Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ)  
**–°—Ç–∞–ª–æ:** `bind-dynamic` (–∂–¥–µ—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)

### 2. –î–æ–±–∞–≤–ª–µ–Ω—ã systemd –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```ini
# /etc/systemd/system/dnsmasq@vmwgnat.service.d/override.conf
[Unit]
After=network-online.target
Wants=network-online.target
# Start after vmwg0 interface is configured
After=sys-subsystem-net-devices-vmwg0.device
Wants=sys-subsystem-net-devices-vmwg0.device
```

### 3. –£–ª—É—á—à–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞ –≤ –ø–ª–µ–π–±—É–∫–µ
1. –ü–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `vmwg0`
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞  
3. –ü–∞—É–∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏
4. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è `UP`
5. –ó–∞–ø—É—Å–∫ `dnsmasq@vmwgnat`

### 4. –î–æ–±–∞–≤–ª–µ–Ω –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
```bash
/root/debug-dnsmasq.sh
```

## üîß –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `templates/dnsmasq-default.conf.j2` - –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ `bind-dynamic`
- `deploy-vmwg-subnet.yml` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `cleanup-vmwg-subnet.yml` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- `templates/debug-dnsmasq.sh.j2` - –Ω–æ–≤—ã–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç

## üìã –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

```bash
# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
ansible-playbook deploy-vmwg-subnet.yml

# –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞–ª–∏—Å—å - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
ssh root@pve-host
/root/debug-dnsmasq.sh
```

## üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
systemctl status dnsmasq@vmwgnat

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
ip addr show vmwg0

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DHCP
cat /var/lib/misc/dnsmasq.vmwgnat.leases
```

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞–ª–∏—Å—å:

```bash
# –†—É—á–Ω–æ–π —Ç–µ—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
dnsmasq --test --conf-dir=/etc/dnsmasq.d/vmwgnat,*.conf

# –ó–∞–ø—É—Å–∫ –≤ debug —Ä–µ–∂–∏–º–µ
dnsmasq --no-daemon --log-queries --conf-dir=/etc/dnsmasq.d/vmwgnat,*.conf

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π systemd
systemctl list-dependencies dnsmasq@vmwgnat
```
