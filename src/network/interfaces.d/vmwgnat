#version:11
# shellcheck disable=SC2148

auto vmwg0
iface vmwg0
address 10.10.0.1/24
post-up iptables -t nat -A POSTROUTING -s '10.10.0.0/24' -o wg0 -j MASQUERADE
post-down iptables -t nat -D POSTROUTING -s '10.10.0.0/24' -o wg0 -j MASQUERADE
post-up iptables -t raw -I PREROUTING -i fwbr+ -j CT --zone 1
post-down iptables -t raw -D PREROUTING -i fwbr+ -j CT --zone 1
# Policy-based routing for VM subnet through WireGuard
post-up ip rule add from 10.10.0.0/24 table 200 priority 100
post-down ip rule del from 10.10.0.0/24 table 200 priority 100 2>/dev/null || true
post-up ip rule add to 10.10.0.0/24 table 200 priority 101
post-down ip rule del to 10.10.0.0/24 table 200 priority 101 2>/dev/null || true
# Default route for table 200 through wg0 (will be set when wg0 comes up)
bridge_ports none
bridge_stp off
bridge_fd 0
ip-forward on
